function e(e,t,o,n){Object.defineProperty(e,t,{get:o,set:n,enumerable:!0,configurable:!0})}var t=globalThis,o={},n={},s=t.parcelRequireea2c;null==s&&((s=function(e){if(e in o)return o[e].exports;if(e in n){var t=n[e];delete n[e];var s={id:e,exports:{}};return o[e]=s,t.call(s.exports,s,s.exports),s.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){n[e]=t},t.parcelRequireea2c=s),(0,s.register)("hkeot",function(t,o){e(t.exports,"symbols",()=>s),e(t.exports,"request",()=>u),e(t.exports,"metroError",()=>b),e(t.exports,"response",()=>f),e(t.exports,"client",()=>i),e(t.exports,"url",()=>p),e(t.exports,"formdata",()=>function e(...t){var o=new FormData;for(let e of t)if(e instanceof FormData)for(let t of e.entries())o.append(t[0],t[1]);else if(e&&"object"==typeof e)for(let t of Object.entries(e))if(Array.isArray(t[1]))for(let e of t[1])o.append(t[0],e);else o.append(t[0],t[1]);else throw new b("metro.formdata: unknown option type, only FormData or Object supported",e);return Object.freeze(o),new Proxy(o,{get:(t,o,n)=>{switch(o){case s.isProxy:return!0;case s.source:return t;case"with":return function(...o){return e(t,...o)};case"toString":case"toJSON":return function(){return t[o]()}}return t[o]}})}),e(t.exports,"trace",()=>g);let n="https://metro.muze.nl/details/",s={isProxy:Symbol("isProxy"),source:Symbol("source")};class a{#e={url:"undefined"!=typeof window?window.location:"https://localhost"};#t=["get","post","put","delete","patch","head","options","query"];static tracers={};constructor(...e){for(let t of e)if("string"==typeof t||t instanceof String)this.#e.url=""+t;else if(t instanceof a)Object.assign(this.#e,t.#e);else if(t instanceof Function)this.#r([t]);else if(t&&"object"==typeof t)for(let e in t)"middlewares"==e?this.#r(t[e]):"function"==typeof t[e]?this.#e[e]=t[e](this.#e[e],this.#e):this.#e[e]=t[e];for(let e of(this.#e.verbs&&(this.#t=this.#e.verbs,delete this.#e.verbs),this.#t))this[e]=async function(...t){return this.#o(u(this.#e,...t,{method:e.toUpperCase()}))};Object.freeze(this)}#r(e){"function"==typeof e&&(e=[e]);let t=e.findIndex(e=>"function"!=typeof e);if(t>=0)throw b("metro.client: middlewares must be a function or an array of functions "+n+"client/invalid-middlewares-value/",e[t]);Array.isArray(this.#e.middlewares)||(this.#e.middlewares=[]),this.#e.middlewares=this.#e.middlewares.concat(e)}#o(e){let t;if(!e.url)throw b("metro.client."+r.method.toLowerCase()+": Missing url parameter "+n+"client/missing-url-param/",e);let o=[async e=>(e[s.isProxy]&&(e=e[s.source]),f(await fetch(e)))].concat(this.#e?.middlewares?.slice()||[]);for(let e of(this.#e,o))t=function(e,t){return async function(o){let n;let s=Object.values(a.tracers);for(let e of s)e.request&&e.request.call(e,o);for(let a of(n=await t(o,e),s))a.response&&a.response.call(a,n);return n}}(t,e);return t(e)}with(...e){return new a(this,...e)}}function i(...e){return new a(...e)}function c(e,t){let o=t.body;return o||(null===e?o=new ReadableStream:e instanceof ReadableStream?o=e:e instanceof Blob?o=e.stream():o=new ReadableStream({start(t){let o;switch(typeof e){case"object":if("function"==typeof e.toString)o=e.toString();else if(e instanceof FormData)o=new URLSearchParams(e).toString();else if(e instanceof ArrayBuffer||ArrayBuffer.isView(e))o=e;else throw b("Cannot convert body to ReadableStream",e);break;case"string":case"number":case"boolean":o=e;break;default:throw b("Cannot convert body to ReadableStream",e)}t.enqueue(o),t.close()}})),new Proxy(o,{get(t,o,n){switch(o){case s.isProxy:return!0;case s.source:return e;case"toString":return function(){return""+e}}return"object"==typeof e&&o in e?"function"==typeof e[o]?function(...t){return e[o].apply(e,t)}:e[o]:o in t&&"toString"!=o?"function"==typeof t[o]?function(...e){return t[o].apply(t,e)}:t[o]:void 0},has:(t,o)=>o in e,ownKeys:t=>Reflect.ownKeys(e),getOwnPropertyDescriptor:(t,o)=>Object.getOwnPropertyDescriptor(e,o)})}function u(...e){let t={url:"undefined"!=typeof window?window.location:"https://localhost/",duplex:"half"};for(let o of e)"string"==typeof o||o instanceof URL||o instanceof URLSearchParams?t.url=p(t.url,o):o&&(o instanceof FormData||o instanceof ReadableStream||o instanceof Blob||o instanceof ArrayBuffer||o instanceof DataView)?t.body=o:o&&"object"==typeof o&&Object.assign(t,function(e,t){let o=t||{};for(let n of(!o.url&&t.url&&(o.url=t.url),["method","headers","body","mode","credentials","cache","redirect","referrer","referrerPolicy","integrity","keepalive","signal","priority","url"]))if("function"==typeof e[n])e[n](o[n],o);else if(void 0!==e[n]){if("url"==n)o.url=p(o.url,e.url);else if("headers"==n)for(let[n,s]of(o.headers=new Headers(t.headers),e.headers instanceof Headers||(e.headers=new Headers(e.headers)),e.headers.entries()))o.headers.set(n,s);else o[n]=e[n]}return o}(o,t));let o=t.body;!o||"object"!=typeof o||o instanceof String||o instanceof ReadableStream||o instanceof Blob||o instanceof ArrayBuffer||o instanceof DataView||o instanceof FormData||o instanceof URLSearchParams||"undefined"!=typeof TypedArray&&o instanceof TypedArray||(t.body=JSON.stringify(o));let n=new Request(t.url,t);return Object.freeze(n),new Proxy(n,{get(e,t,n){switch(t){case s.source:return e;case s.isProxy:return!0;case"with":return function(...t){return u(e,...t)};case"toString":case"toJSON":case"blob":case"text":case"json":return function(){return e[t].apply(e)};case"body":if(o||(o=e.body),o){if(o[s.isProxy])return o;return c(o,e)}}return e[t]}})}function l(e,t){let o=t||{};for(let n of(!o.url&&t.url&&(o.url=t.url),["status","statusText","headers","body","url","type","redirected"]))"function"==typeof e[n]?e[n](o[n],o):void 0!==e[n]&&("url"==n?o.url=new URL(e.url,o.url||"https://localhost/"):o[n]=e[n]);return o}function f(...e){let t={};for(let o of e)"string"==typeof o?t.body=o:o instanceof Response?Object.assign(t,l(o,t)):o&&"object"==typeof o&&(o instanceof FormData||o instanceof Blob||o instanceof ArrayBuffer||o instanceof DataView||o instanceof ReadableStream||o instanceof URLSearchParams||o instanceof String||"undefined"!=typeof TypedArray&&o instanceof TypedArray?t.body=o:Object.assign(t,l(o,t)));let o=new Response(t.body,t);return Object.freeze(o),new Proxy(o,{get(e,o,n){switch(o){case s.isProxy:return!0;case s.source:return e;case"with":return function(...t){return f(e,...t)};case"body":if(!t.body)return c("",e);if(t.body[s.isProxy])return t.body;return c(t.body,e);case"ok":return e.status>=200&&e.status<400;case"headers":return e.headers;default:if(o in t&&"toString"!=o)return t[o];if(o in e&&"toString"!=o){if("function"==typeof e[o])return function(...t){return e[o].apply(e,t)};return e[o]}}}})}function h(e,t){"function"==typeof t?t(e.searchParams,e):(t=new URLSearchParams(t)).forEach((t,o)=>{e.searchParams.append(o,t)})}function p(...e){let t=["hash","host","hostname","href","password","pathname","port","protocol","username","search","searchParams"],o=new URL("https://localhost/");for(let s of e)if("string"==typeof s||s instanceof String)o=new URL(s,o);else if(s instanceof URL||"undefined"!=typeof Location&&s instanceof Location)o=new URL(s);else if(s instanceof URLSearchParams)h(o,s);else if(s&&"object"==typeof s)for(let a in s)if("search"==a)"function"==typeof s.search?s.search(o.search,o):o.search=new URLSearchParams(s.search);else if("searchParams"==a)h(o,s.searchParams);else{if(!t.includes(a))throw b("metro.url: unknown url parameter "+n+"url/unknown-param-name/",a);if("function"==typeof s[a])s[a](o[a],o);else if("string"==typeof s[a]||s[a]instanceof String||"number"==typeof s[a]||s[a]instanceof Number||"boolean"==typeof s[a]||s[a]instanceof Boolean)o[a]=""+s[a];else if("object"==typeof s[a]&&s[a].toString)o[a]=s[a].toString();else throw b("metro.url: unsupported value for "+a+" "+n+"url/unsupported-param-value/",e[a])}else throw b("metro.url: unsupported option value "+n+"url/unsupported-option-value/",s);return Object.freeze(o),new Proxy(o,{get(e,t,o){switch(t){case s.isProxy:return!0;case s.source:return e;case"with":return function(...t){return p(e,...t)};case"toString":case"toJSON":return function(){return e[t]()}}return e[t]}})}let d=(e,...t)=>{console.error("Ⓜ️  ",e,...t)},y=(e,...t)=>{console.info("Ⓜ️  ",e,...t)},w=e=>{console.group("Ⓜ️  "+e)},m=e=>{console.groupEnd("Ⓜ️  "+e)};function b(e,...t){return d(e,...t),Error(e,...t)}let g={add(e,t){a.tracers[e]=t},delete(e){delete a.tracers[e]},clear(){a.tracers={}},group(){let e=0;return{request:t=>{w(++e),y(t?.url,t)},response:t=>{y(t?.body?t.body[s.source]:null,t),m(e),e--}}}}});var a=s("hkeot"),i={};e(i,"enable",()=>u),e(i,"disable",()=>l),e(i,"fails",()=>f),e(i,"check",()=>h),e(i,"optional",()=>p),e(i,"oneOf",()=>d);let c=!1;function u(){c=!0}function l(){c=!1}function f(e,t){let o=[];if(t instanceof RegExp){if(Array.isArray(e)){let n=e.findIndex(e=>f(e,t));n>-1&&o.push("data["+n+"] does not match pattern")}else t.test(e)||o.push("data does not match pattern "+t)}else if(t instanceof Function)t(e)&&o.push("data does not match function");else if(t&&"object"==typeof t){if(Array.isArray(e)){let n=e.findIndex(e=>f(e,t));n>-1&&o.push("data["+n+"] does not match pattern")}else if(e&&"object"==typeof e){e instanceof URLSearchParams&&(e=Object.fromEntries(e));let n=o[o.length-1];for(let[s,a]of Object.entries(t)){let t=f(e[s],a);t&&(n&&"string"!=typeof n||(n={},o.push(n)),n[s]=t.problems)}}else o.push("data is not an object, pattern is")}else t!=e&&o.push("data does not equal "+t);return!!o.length&&o}function h(e,t){if(!c)return;let o=f(e,t);if(o)throw new y(o,e)}function p(e){return function(t){return null!=t&&void 0!==t&&f(t,e)}}function d(...e){return function(t){for(let o of e)if(!f(t,o))return!1;return["data does not match oneOf patterns"]}}class y{constructor(e,...t){this.problems=e,this.details=t,console.trace()}}function w(e){return e=Object.assign({reviver:null,replacer:null,space:""},e),async(t,o)=>{["POST","PUT","PATCH","QUERY"].includes(t.method)?(t=t.with({headers:{"Content-Type":"application/json",Accept:"application/json"}})).body&&"object"==typeof t.body[a.symbols.source]&&(t=t.with({body:JSON.stringify(t.body[a.symbols.source],e.replacer,e.space)})):t=t.with({headers:{Accept:"application/json"}});let n=await o(t),s=JSON.parse(await n.text(),e.reviver);return n.with({body:s})}}var a=(s("hkeot"),s("hkeot"));s("hkeot"),window.metro=a,window.assert=i,window.metro.mw={jsonmw:w,oauth2:function(e){let t,o;if("undefined"!=typeof localStorage)t={get:()=>localStorage.getItem("metro/state"),has:()=>localStorage.getItem("metro/state"),set:e=>localStorage.setItem("metro/state",e)},o={get:e=>localStorage.getItem(e),set:(e,t)=>localStorage.setItem(e,t),has:e=>localStorage.hasItem(e)};else{let e=new Map;t={get:()=>e.get("metro/state"),has:()=>e.get("metro/state"),set:t=>e.set("metro/state",t)},o=new Map}let n={tokens:o,state:t,endpoints:{authorize:"/authorize",token:"/token"},callbacks:{authorize:e=>document.location=e},client:a.client().with(w()),client_id:"",client_secret:"",redirect_uri:"",grant_type:"authorization_code",force_authorization:!1};for(let t in e){switch(t){case"access_token":case"authorization_code":case"refresh_token":n.tokens.set(t,e[t]);break;case"client":case"client_id":case"client_secret":case"grant_type":case"force_authorization":case"redirect_uri":n[t]=e[t];break;case"state":case"tokens":if("function"==typeof e[t].set&&"function"==typeof e[t].get&&"function"==typeof e[t].has)n[t]=e[t];else if("tokens"==t&&"object"==typeof e.tokens)for(let t in e.tokens)n.tokens.set(t,e.tokens[t]);else throw a.metroError("metro/mw/oauth2: incorrect value for "+t);break;case"endpoints":for(let t in e.endpoints)if("authorize"!=t&&"token"!=t)throw a.metroError('Unknown endpoint, choose one of "authorize" or "token"',t);Object.assign(n.endpoints,e.endpoints);break;case"callbacks":for(let t in e.callbacks)if("authorize"!=t)throw a.metroError('Unknown callback, choose one of "authorize"',t);Object.assign(n.callbacks,e.callbacks);break;default:throw a.metroError("Unknown oauth2mw option ",t)}n.redirect_uri||(n.redirect_uri="undefined"!=typeof window?window.location?.href:""),n.redirect_uri&&(n.redirect_uri=a.url(n.redirect_uri).with("?metroRedirect=true"))}return async function(e,t){if(n.force_authorization)return s(e,t);let o=await t(e);if(o.ok)return o;switch(o.status){case 400:case 401:return s(e,t)}return o};async function s(e,t){if(function(){if("undefined"!=typeof window&&window?.location){let e,t,o,s=a.url(window.location);if(s.searchParams.has("code")?(o=s.searchParams,s=s.with({search:""}),history.pushState({},"",s.href)):s.hash&&(o=new URLSearchParams("?"+s.hash.substr(1)),s=s.with({hash:""}),history.pushState({},"",s.href)),o){e=o.get("code"),t=o.get("state");let s=n.state.get("metro/state");if(!t||t!==s)return;e&&n.tokens.set("authorization_code",e)}}}(),n.tokens.has("access_token")){if(function(e){if(e.oauth2&&e.oauth2.tokens&&e.oauth2.tokens.has("access_token")){let t=new Date,o=e.oauth2.tokens.get("access_token");return t.getTime()>o.expires.getTime()}return!1}(e))return await c(e)?s(e,t):a.response("false");{let o=n.tokens.get("access_token");return t(e=a.request(e,{headers:{Authorization:o.type+" "+o.value}}))}}return await i(e)?s(e,t):a.response("false")}async function i(e){if("authorization_code"===n.grant_type&&!n.tokens.has("authorization_code")){let e=function(){if(!n.endpoints.authorize)throw a.metroError("oauth2mw: Missing options.endpoints.authorize url");let e=a.url(n.endpoints.authorize,{hash:""});h(n,{client_id:/.+/,redirect_uri:/.+/,scope:/.*/});let t={response_type:"code",client_id:n.client_id,redirect_uri:n.redirect_uri,state:function(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o="",s=0;for(;s<40;)o+=t.charAt(Math.floor(Math.random()*t.length)),s++;return n.state.set(o),o}(0)};return n.scope&&(t.scope=n.scope),a.url(e,{search:t})}();if(!n.callbacks.authorize||"function"!=typeof n.callbacks.authorize)throw a.metroError("oauth2mw: oauth2 with grant_type:authorization_code requires a callback function in client options.oauth2.callbacks.authorize");let t=await n.callbacks.authorize(e);if(!t)return a.response(!1);n.tokens.set("authorization_code",t)}let t=u(),o=await n.client.get(t);if(!o.ok)throw a.metroError(o.status+":"+o.statusText,await o.text());let s=await o.json();return n.tokens.set("access_token",{value:s.access_token,expires:l(s.expires_in),type:s.token_type,scope:s.scope}),s.refresh_token&&n.tokens.set("refresh_token",s.refresh_token),s}async function c(e,t){let o=u("refresh_token"),s=await n.client.get(o);if(!s.ok)throw a.metroError(s.status+":"+s.statusText,await s.text());let i=await s.json();return n.tokens.set("access_token",{value:i.access_token,expires:l(i.expires_in),type:i.token_type,scope:i.scope}),i.refresh_token&&n.tokens.set("refresh_token",i.refresh_token),i}function u(e=null){if(h(n,{client_id:/.+/,client_secret:/.+/,redirect_uri:/.+/}),!n.endpoints.token)throw a.metroError("oauth2mw: Missing options.endpoints.token url");let t=a.url(n.endpoints.token,{hash:""}),o={grant_type:e||n.grant_type,client_id:n.client_id,client_secret:n.client_secret};switch(n.scope&&(o.scope=n.scope),n.grant_type){case"authorization_code":o.redirect_uri=n.redirect_uri,o.code=n.tokens.get("authorization_code");break;case"client_credentials":case"refresh_token":throw Error("Not yet implemented")}return a.request(t,{method:"GET",url:{searchParams:o}})}function l(e){if(e instanceof Date)return new Date(e.getTime());if("number"==typeof e){let t=new Date;return t.setSeconds(t.getSeconds()+e),t}throw TypeError("Unknown expires type "+e)}},thrower:function(e){return async(t,o)=>{let n=await o(t);if(!n.ok){if(e&&"function"==typeof e[n.status])n=e[n.status].apply(n,t);else throw Error(n.status+": "+n.statusText,{cause:n})}return n}}};
//# sourceMappingURL=everything.js.map
